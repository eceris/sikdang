<html>
	<head>
		<script type="text/javascript">
			var config = { 
				'한식' : {
					'불고기' : [
						'원조쌈밥집', 
						'싸리방',
						'남원추어탕'
					],
					'찜닭' : [
						'고수찜닭',
						'내찜닭'
					],
					'해장국' : [
						'무봉리순대국',
						'이화수육개장'
					],
					'백반' : [
						'엄마의 밥상',
						'시골밥상'
					]
				},
				'분식' : [
					'김밥나라',
					'배꼽빵빵'
				]
			};
			var currentNode = "";
			var nodeTemplate = null;
			var randomValue = [];
			var children = [];
			
			function draw(childs) {
				if (childs == -1) {
					document.getElementById('randomSelect').style.display = "none";
					document.getElementById('oneClickSelect').style.display = "none";
				}
				nodeTemplate = document.getElementById('nodeTemplate');
				var nodesHTML = '';
				if (!childs || 0) {
					childs = config;
				}
				for(var node in childs) {
					console.log('node: ' + node);
					var templateStr = nodeTemplate.innerHTML;
					if (Array.isArray(childs)) {
						templateStr = templateStr.replace('{{node}}', childs[node]);
					} else {
						templateStr = templateStr.replace('{{node}}', node);
					}
					nodesHTML += templateStr;
				}
				document.getElementById('nodes').innerHTML = nodesHTML;
			}

			function select(e) {
				var nodeSpan = e.getElementsByTagName('span')[0];
				currentNode = nodeSpan.innerHTML;	
				var childs = searchChild(config);
				draw(childs);
			}

			function randomSelect(e) {
				var item = document.getElementById('nodes').getElementsByClassName('item');
				for(var i in item) {
					if (item.hasOwnProperty(i)) {
						var value = item[i].getElementsByTagName('span')[0].textContent;
						if (value || 0) {
							randomValue.push(value);	
						}	
					}
				}
				currentNode = randomValue[Math.floor(Math.random()*randomValue.length)];
				var childs = searchChild(config);
				draw(childs);
			}


			function searchChild(parent) {
				console.log('parent: ' + parent);
				
				if(Array.isArray(parent) || Object.keys(parent).length == 0) {
					return -1;
				}
				
				for(var key in parent) {
					if(currentNode == key) {
						var ret = parent[key];
						if(Array.isArray(ret)) {
							return ret;
						} else {
							return Object.keys(ret);
						}
					} else {
						var ret = searchChild(parent[key]);
						if(ret != -1) {
							return ret;
						}
					}
				}
				
				return -1;
			}
			
			function oneClickSelect(e) {
				
				getAllChildrend(config);
				alert(children[Math.floor(Math.random()*children.length)]);
			}

			function getAllChildrend(parent) {
				
				if(Array.isArray(parent) || Object.keys(parent).length == 0) {
					children = children.concat(parent);
					return -1;
				}
				
				for(var key in parent) {
					var ret = getAllChildrend(parent[key]);
					if(ret != -1) {
						return ret;
					}
				}
				return -1;
			}

			
		</script>
		<style>
			.node { border:1px solid blue; float: left; margin: 10px; text-align: center; cursor: pointer; }
			.node span { width:200px; height:200px; border:1px solid red; display:table-cell; vertical-align: middle; font-size:30pt }
		</style>
	</head>
	<body onload="draw()">
		<div id="nodeTemplate" style="display:none">

			<div class="node item" onclick="select(this)">
				<span>{{node}}</span>
			</div>

		</div>
		<div id="nodes">
		</div>
		<div id="randomSelect">
			<div class="node" onclick="randomSelect(this)">
					<span>random</span>
			</div>
		</div>
		<div id="oneClickSelect">
			<div class="node" onclick="oneClickSelect(this)">
					<span>oneClickSelect</span>
			</div>
		</div>

	</body>
</html>