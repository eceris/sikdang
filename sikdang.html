<html>
	<head>
		<script type="text/javascript">
			var config = { 
				'한식' : {
					'불고기' : [
						'원조쌈밥집', 
						'싸리방',
						'남원추어탕'
					],
					'찜닭' : [
						'고수찜닭',
						'내찜닭'
					],
					'해장국' : [
						'무봉리순대국',
						'이화수육개장'
					],
					'백반' : [
						'엄마의 밥상',
						'시골밥상'
					]
				},
				'분식' : [
					'김밥나라',
					'배꼽빵빵'
				]
			};
			var currentNode = "";
			var nodeTemplate = null;
			var randomValue = [];
			var children = [];
			
			function draw(childs) {
				var nodesHTML = '';
				for(var node in childs) {
					console.log('node: ' + node);
					var templateStr = nodeTemplate.innerHTML;
					templateStr = templateStr.replace('{{node}}', childs[node]);
					
					nodesHTML += templateStr;
				}
				document.getElementById('nodes').innerHTML = nodesHTML;
			}

			function select(e) {
				var nodeSpan = e.getElementsByTagName('span')[0];
				currentNode = nodeSpan.innerHTML;	
				var childs = searchChild(config);
				
				if (childs != -1) {
					draw(childs);
				}
			}

			function randomSelect(e) {
				var item = document.getElementById('nodes').getElementsByClassName('node');
				var randomIndex = Math.floor(Math.random() * item.length);
				selectRandom(randomIndex);
			}
			function searchChild(parent) {
				console.log('parent: ' + parent);
				
				if(Array.isArray(parent) || Object.keys(parent).length == 0) {
					return -1;
				}
				
				for(var key in parent) {
					if(currentNode == key) {
						var ret = parent[key];
						if(Array.isArray(ret)) {
							return ret;
						} else {
							return Object.keys(ret);
						}
					} else {
						var ret = searchChild(parent[key]);
						if(ret != -1) {
							return ret;
						}
					}
				}
				
				return -1;
			}
			function selectRandom(destIndex) {
				var nodes = document.getElementById("nodes").getElementsByTagName('div');
				
				var totalDelay = 3600;
				var nextDelay = 50;
				
				var currIndex = -1;
				
				var animate = function(){
					if(totalDelay < nextDelay && currIndex == destIndex) {
						// TODO disable other node display and destination node click
						return;
					}
					
					if(currIndex != -1) {
						nodes[currIndex].className = 'node';
					}
					currIndex = currIndex + 1;
					if(currIndex == nodes.length) {
						currIndex = 0;
					}
					nodes[currIndex].className = 'selectNode';
					
					nextDelay = nextDelay * 1.1;
					totalDelay = totalDelay - nextDelay;
					setTimeout(function() {
						animate();
					}, nextDelay);
				};
				
				animate();
			}
			
			function oneClickSelect(e) {
				
				getAllChildrend(config);
				alert(children[Math.floor(Math.random()*children.length)]);
			}
			function getAllChildrend(parent) {
				
				if(Array.isArray(parent) || Object.keys(parent).length == 0) {
					children = children.concat(parent);
					return -1;
				}
				
				for(var key in parent) {
					var ret = getAllChildrend(parent[key]);
					if(ret != -1) {
						return ret;
					}
				}
				return -1;
			}
			function init() {
				nodeTemplate = document.getElementById('nodeTemplate');
				draw(Object.keys(config));
			}
		</script>
		<style>
			.node { border:1px solid blue; float: left; margin: 10px; text-align: center; cursor: pointer; }
			.node span { width:200px; height:200px; border:1px solid red; display:table-cell; vertical-align: middle; font-size:30pt }
			.selectNode { background-color: blue; float: left; margin: 10px; text-align: center; cursor: pointer; }
			.selectNode span { width:200px; height:200px; display:table-cell; vertical-align: middle; font-size:30pt; color:white; font-weight: bold; }
		</style>
	</head>
	<body onload="init()">
		<div id="nodeTemplate" style="display:none">

			<div class="node" onclick="select(this)">
				<span>{{node}}</span>
			</div>

		</div>
		<div id="nodes">
		</div>
		<div id="randomSelect">
			<div class="node" onclick="randomSelect(this)">
					<span>random</span>
			</div>
		</div>
		<div id="oneClickSelect">
			<div class="node" onclick="oneClickSelect(this)">
					<span>oneClickSelect</span>
			</div>
		</div>

	</body>
</html>